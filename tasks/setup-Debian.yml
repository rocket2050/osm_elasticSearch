---
# Setup Java on System

- name: determine if Java is already installed
  shell: which java
  register: oracle_java_task_installed
  changed_when: oracle_java_task_installed.rc != 0
  failed_when: no

- name: debian | ubuntu | add java ppa repo
  apt_repository:
    repo='ppa:webupd8team/java'
    state=present

- name: Update and upgrade apt packages
  become: true
  apt:
    update_cache: yes
    cache_valid_time: 86400 #One day

- name: auto accept oracle jdk license
  shell: echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | /usr/bin/debconf-set-selections
  sudo: yes

- name: ensure Java is installed
  become: true
  apt: name=oracle-java8-installer state=present force=yes

- name: set Java version as default
  apt:
    name="oracle-java{{ oracle_java_version }}-set-default"

# Download ElasticSearch

- name: download elastic search for standalone
  become: true
  get_url: 
    url: "https://packages.elastic.co/GPG-KEY-elasticsearch"
    dest: /opt
    owner: root
    mode: 0755

- name: Add Elasticsearch repository.
  apt_repository:
    repo: 'deb https://artifacts.elastic.co/packages/5.x/apt stable main'
    state: present
  become: true
  
- name: add this to source list
  shell: "tee -a /etc/apt/sources.list.d/elastic-5.x.list"
  become: true
  
- name: update cache for Elastic search to be installed
  apt:
    update_cache: yes
    cache_valid_time: 88990070
    dpkg_options: 'force-confold,force-confdef'

- name: Install Elasticsearch
  apt: name=elasticsearch state=present force=yes

- name: update the defaults
  command: "update-rc.d elasticsearch defaults"

